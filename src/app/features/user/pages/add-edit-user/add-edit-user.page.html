<ion-header>
  <ion-toolbar>
      <ion-title>{{ isEditMode ? 'Update user information' : 'Create a new organization user' }}</ion-title>
      <ion-buttons slot="end">
        <ion-button (click)="onCancel()">
          <ion-icon name="close"></ion-icon>
        </ion-button>
      </ion-buttons>
  </ion-toolbar>
</ion-header>

<ng-template #formFields>
  <!-- Basic information -->
  <ion-item-divider>
            <ion-label>Basic information</ion-label>
          </ion-item-divider>
          <ion-grid class="form-grid">
            <ion-row>
              <ion-col size="12" size-md="6">
                <ion-item>
                  <ion-label position="stacked">First name</ion-label>
                  <ion-input formControlName="firstName" type="text" placeholder="First name"></ion-input>
                </ion-item>
                @if (form.get('firstName')?.invalid && form.get('firstName')?.touched) {
                  <p class="field-error">First name is required.</p>
                }
              </ion-col>
              <ion-col size="12" size-md="6">
                <ion-item>
                  <ion-label position="stacked">Surname</ion-label>
                  <ion-input formControlName="surname" type="text" placeholder="Surname"></ion-input>
                </ion-item>
                @if (form.get('surname')?.invalid && form.get('surname')?.touched) {
                  <p class="field-error">Surname is required.</p>
                }
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col size="12" size-md="6">
                <app-email-control formControlName="email"></app-email-control>
              </ion-col>
              <ion-col size="12" size-md="6">
                <ion-item>
                  <ion-label position="stacked">Phone number</ion-label>
                  <ion-input formControlName="phoneNumber" type="tel" placeholder="Phone number"></ion-input>
                </ion-item>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col size="12" size-md="6">
                <ion-item>
                  <ion-label position="stacked">Role</ion-label>
                  <ion-select formControlName="role" placeholder="Select role" interface="popover">
                    <ion-select-option *ngFor="let r of roles" [value]="r">{{ r }}</ion-select-option>
                  </ion-select>
                </ion-item>
              </ion-col>
            </ion-row>
          </ion-grid>

          <!-- Security (only in add user) -->
          @if (!isEditMode) {
            <ion-item-divider>
              <ion-label>Security</ion-label>
            </ion-item-divider>
            <ion-grid class="form-grid">
              <ion-row>
                <ion-col size="12" size-md="6">
                  <app-password-control
                    formControlName="password"
                    label="Security password"
                    [minLength]="6"
                    placeholder="Enter password">
                  </app-password-control>
                  @if (form.get('password')?.invalid && form.get('password')?.touched) {
                    <p class="field-error">Password is required and must be at least 6 characters.</p>
                  }
                </ion-col>
                <ion-col size="12" size-md="6">
                  <ion-item>
                    <ion-label position="stacked">Confirm password</ion-label>
                    <ion-input
                      formControlName="confirmPassword"
                      type="password"
                      placeholder="Confirm password">
                    </ion-input>
                  </ion-item>
                  @if ((form.get('confirmPassword')?.invalid && form.get('confirmPassword')?.touched) || form.errors?.['confirmPasswordMismatch']) {
                    <p class="field-error">{{ getConfirmPasswordError() }}</p>
                  }
                </ion-col>
              </ion-row>
            </ion-grid>
          }

          <!-- Address Details -->
          <ion-item-divider>
            <ion-label>Address Details</ion-label>
          </ion-item-divider>
          <ion-grid class="form-grid">
            <ion-row>
              <ion-col size="12">
                <ion-item>
                  <ion-label position="stacked">Address 1</ion-label>
                  <ion-input formControlName="address1" type="text" placeholder="Address 1"></ion-input>
                </ion-item>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col size="12">
                <ion-item>
                  <ion-label position="stacked">Address 2</ion-label>
                  <ion-input formControlName="address2" type="text" placeholder="Address 2"></ion-input>
                </ion-item>
              </ion-col>
            </ion-row>
            <ion-row>
              <ion-col size="12" size-md="4">
                <ion-item>
                  <ion-label position="stacked">City</ion-label>
                  <ion-input formControlName="city" type="text" placeholder="City"></ion-input>
                </ion-item>
              </ion-col>
              <ion-col size="12" size-md="4">
                <ion-item>
                  <ion-label position="stacked">State</ion-label>
                  <ion-input formControlName="state" type="text" placeholder="State"></ion-input>
                </ion-item>
              </ion-col>
              <ion-col size="12" size-md="4">
                <ion-item>
                  <ion-label position="stacked">Pin code</ion-label>
                  <ion-input formControlName="pinCode" type="text" placeholder="Pin code"></ion-input>
                </ion-item>
              </ion-col>
            </ion-row>
          </ion-grid>
</ng-template>

  @if (errorMessage) {
    <p class="field-error ion-padding">{{ errorMessage }}</p>
  }
  <ion-footer class="ion-no-border modal-footer">
    <ion-toolbar>
      <ion-buttons slot="end" class="footer-actions">
        <ion-button fill="outline" type="button" (click)="onCancel()" [disabled]="saving">Cancel</ion-button>
        <ion-button color="primary" type="submit" form="userForm" [disabled]="form.invalid || saving">
          {{ saving ? 'Savingâ€¦' : (isEditMode ? 'Update User' : 'Create User') }}
        </ion-button>
      </ion-buttons>
    </ion-toolbar>
  </ion-footer>

