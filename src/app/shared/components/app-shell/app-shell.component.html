<ion-header [translucent]="false">
  <div class="org-header">
    <div class="org-info">
      <h2 class="org-name">{{ organization?.name }}</h2>
      <p class="org-details" *ngIf="organization">
        <span *ngIf="organization.phoneNumber">{{ organization.phoneNumber }}</span>
        <span *ngIf="organization.address && organization.phoneNumber"> â€¢ </span>
        <span *ngIf="organization.address">{{ organization.address }}</span>
      </p>
    </div>
    <div class="header-center">
      <h2 class="header-branch-name" *ngIf="mode === 'BRANCH' && selectedBranch">{{ selectedBranch.name }}</h2>
    </div>
    <div class="user-section">
      <span class="mode-badge" [class.mode-org]="mode === 'ORG'" [class.mode-branch]="mode === 'BRANCH'">
        {{ mode === 'ORG' ? 'ORG MODE' : 'BRANCH MODE' }}
      </span>
      <div class="user-info">
        <ion-icon name="person-circle-outline" class="user-icon"></ion-icon>
        <span class="user-email">{{ userDisplayName }}</span>
        <ion-icon name="chevron-down-outline" class="dropdown-icon"></ion-icon>
      </div>
      <ion-button fill="clear" class="logout-btn" (click)="onLogout()">
        <ion-icon name="log-out-outline" slot="start"></ion-icon>
        LOG OUT
      </ion-button>
    </div>
  </div>
</ion-header>

<div class="app-layout">
  <aside class="sidebar">
    <nav class="nav-sidebar">
      <a
        *ngIf="showReturnToOrg"
        class="nav-item return-to-org-item"
        (click)="onReturnToOrgMode(); $event.preventDefault()"
        href="javascript:void(0)">
        <ion-icon name="arrow-back-outline" class="return-icon"></ion-icon>
        Return back to Org Mode
      </a>

      <ng-container *ngFor="let menu of filteredMenu">
        <!-- Leaf item with route -->
        @if (menu.route !== undefined && !menu.children?.length) {
          <a
            class="nav-item"
            [routerLink]="getLink(menu.route)"
            routerLinkActive="active"
            [routerLinkActiveOptions]="{ exact: isDashboardRoot(menu.route) }">
            {{ menu.label }}
          </a>
        }

        <!-- Parent with children (expand/collapse) -->
        @if (menu.children?.length) {
          <div class="nav-item-container">
            <button
              type="button"
              class="nav-item"
              [class.active]="isExpanded(menu.key)"
              (click)="toggleExpanded(menu.key)">
              <span>{{ menu.label }}</span>
              <ion-icon
                [name]="isExpanded(menu.key) ? 'chevron-down-outline' : 'chevron-forward-outline'"
                class="submenu-icon"></ion-icon>
            </button>
            @if (isExpanded(menu.key)) {
              <div class="submenu-vertical">
                @for (child of menu.children; track child.key) {
                  <a
                    class="submenu-item"
                    [routerLink]="getLink(child.route)"
                    routerLinkActive="active">
                    {{ child.label }}
                  </a>
                }
              </div>
            }
          </div>
        }
      </ng-container>
    </nav>
  </aside>
  <main class="main-content">
    <ng-content></ng-content>
  </main>
</div>
