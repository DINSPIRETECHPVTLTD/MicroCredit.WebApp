<ion-header [translucent]="false">
  <div class="org-header">
    <div class="org-info">
      <h2 class="org-name">{{ organization?.name || defaultOrgName }}</h2>
      <p class="org-details" *ngIf="organization">
        <span *ngIf="organization.phone">{{ organization.phone }}</span>
        <span *ngIf="organization.city && organization.phone"> â€¢ </span>
        <span *ngIf="organization.city">{{ organization.city }}</span>
      </p>
    </div>
    <div class="header-center">
      <h2 class="header-branch-name" *ngIf="isBranchMode && selectedBranch">{{ selectedBranch?.name }}</h2>
    </div>
    <div class="user-section">
      <span *ngIf="isOrgOwner" class="mode-badge" [class.mode-org]="isOrgMode" [class.mode-branch]="isBranchMode">
        {{ isOrgMode ? 'Org Mode' : 'Branch Mode' }}
      </span>
      <a *ngIf="isOrgOwner && isBranchMode" class="return-to-org" (click)="onReturnToOrgMode()" href="javascript:void(0)">
        Return back to Org Mode
      </a>
      <div class="user-info">
        <ion-icon name="person-circle-outline" class="user-icon"></ion-icon>
        <span class="user-email">{{ userDisplayName }}</span>
        <ion-icon name="chevron-down-outline" class="dropdown-icon"></ion-icon>
      </div>
      <ion-button fill="clear" class="logout-btn" (click)="onLogout()">
        <ion-icon name="log-out-outline" slot="start"></ion-icon>
        Log Out
      </ion-button>
    </div>
  </div>
</ion-header>

<div class="app-layout">
  <aside class="sidebar">
    <nav class="nav-sidebar" *ngIf="isOrgMode">
      <button
        class="nav-item"
        [class.active]="activeMenu === 'Dashboard'"
        (click)="onMenuChange('Dashboard')">
        Dashboard
      </button>
      <button
        class="nav-item"
        [class.active]="activeMenu === 'Info'"
        (click)="onMenuChange('Info')">
        Org Info
      </button>
      <button
        class="nav-item"
        [class.active]="activeMenu === 'Users' || activeMenu === 'All Users' || activeMenu === 'Approvals'"
        (click)="onMenuChange('Users')">
        Users
      </button>
      <button
        class="nav-item"
        [class.active]="activeMenu === 'Branches' || activeMenu === 'All Branches'"
        (click)="onMenuChange('Branches')">
        Branches
      </button>
      <div class="nav-item-container">
        <button
          class="nav-item"
          [class.active]="activeMenu === 'Master' || activeMenu === 'Master Data' || activeMenu === 'Payment Terms'"
          (click)="onMenuChange('Master')">
          <span>Master</span>
          <ion-icon [name]="showMasterSubmenu ? 'chevron-forward-outline' : 'chevron-down-outline'" class="submenu-icon"></ion-icon>
        </button>
        <div class="submenu-vertical" *ngIf="showMasterSubmenu">
          <button class="submenu-item" [class.active]="activeMenu === 'Master Data'" (click)="onSubmenuSelect('Master Data')">Master Data</button>
          <button class="submenu-item" [class.active]="activeMenu === 'Payment Terms'" (click)="onSubmenuSelect('Payment Terms')">Payment Terms</button>
        </div>
      </div>
      <div class="nav-item-container">
        <button
          class="nav-item"
          [class.active]="activeMenu === 'Funds' || activeMenu === 'Investments' || activeMenu === 'Funds Transfer'"
          (click)="onMenuChange('Funds')">
          <span>Funds</span>
          <ion-icon [name]="showFundsSubmenu ? 'chevron-forward-outline' : 'chevron-down-outline'" class="submenu-icon"></ion-icon>
        </button>
        <div class="submenu-vertical" *ngIf="showFundsSubmenu">
          <button class="submenu-item" [class.active]="activeMenu === 'Investments'" (click)="onSubmenuSelect('Investments')">Investments</button>
          <button class="submenu-item" [class.active]="activeMenu === 'Ledger Balances'" (click)="onSubmenuSelect('Ledger Balances')">Ledger Balances</button>
        </div>
      </div>
    </nav>

    <nav class="nav-sidebar" *ngIf="isBranchMode">
      <button
        class="nav-item"
        [class.active]="activeMenu === 'Dashboard' || activeMenu === 'My View'"
        (click)="onMenuChange(isStaff ? 'My View' : 'Dashboard')">
        Dashboard
      </button>
      <button class="nav-item" [class.active]="activeMenu === 'Centers'" (click)="onMenuChange('Centers')">Centers</button>
      <button class="nav-item" [class.active]="activeMenu === 'POCs'" (click)="onMenuChange('POCs')">POCs</button>
      <button class="nav-item" [class.active]="activeMenu === 'Staff'" (click)="onMenuChange('Staff')" *ngIf="!isBranchUser">Staff</button>
      <button class="nav-item" [class.active]="activeMenu === 'Members'" (click)="onMenuChange('Members')">Members</button>
      <div class="nav-item-container">
        <button
          class="nav-item"
          [class.active]="activeMenu === 'Loan' || activeMenu === 'Add Loan' || activeMenu === 'Manage Loan'"
          (click)="onMenuChange('Loan')">
          <span>Loans</span>
          <ion-icon [name]="showLoanSubmenu ? 'chevron-forward-outline' : 'chevron-down-outline'" class="submenu-icon"></ion-icon>
        </button>
        <div class="submenu-vertical" *ngIf="showLoanSubmenu">
          <button class="submenu-item" [class.active]="activeMenu === 'Add Loan'" (click)="onSubmenuSelect('Add Loan')">Add Loan</button>
          <button class="submenu-item" [class.active]="activeMenu === 'Manage Loan'" (click)="onSubmenuSelect('Manage Loan')">Manage Loan</button>
        </div>
      </div>
      <button
        class="nav-item"
        [class.active]="activeMenu === 'Recovery Posting'"
        (click)="onMenuChange('Recovery Posting')">
        Recovery Posting
      </button>
    </nav>
  </aside>
  <main class="main-content">
    <ng-content></ng-content>
  </main>
</div>
